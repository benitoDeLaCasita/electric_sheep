# -*- mode: ruby -*-
# vi: set ft=ruby :

# Local working directory
working_directory "/tmp/electric_sheep"

host "acceptance-container", hostname: "127.0.0.1",
  description: "ElectricSheeps - Container for acceptance testing", # optional
  ssh_port: 2222, #optional
  working_directory: "/tmp/remote_electric_sheep" #optional

project "scp-move-local-to-remote" do
  private_key './acceptance/id_rsa'
  resource :file, path: "/tmp/electric_sheep/dummy.file"
  copy to: "acceptance-container", using: :scp, as: "vagrant"
end

# project "scp-move-remote-to-local" do
#   resource :file, path: "dummy.file", host: "acceptance-container"
#   move to: localhost, using: :scp, as: "vagrant"
# end

project "mongodb-dump", description: "MongoDB database backup" do
  private_key './acceptance/id_rsa'
  resource :database, name: "controldb", host: "acceptance-container"
  remotely as: "vagrant" do
    mongodb_dump
    tar_gz
  end
  copy to: localhost, using: :scp, as: "vagrant"
  # locally do
  #   encrypt
  # end
  #copy to: "backup-store", using: :scp
  #move to: 'my/bucket', using: :s3
end

project "mysql-dump", description: "MySQL database backup" do

  private_key './acceptance/id_rsa'
  resource :database, name: "controldb", host: "acceptance-container"
  remotely as: "vagrant" do
    mysql_dump user: "operator", password: "pseudorandom"
    tar_gz
  end

end
